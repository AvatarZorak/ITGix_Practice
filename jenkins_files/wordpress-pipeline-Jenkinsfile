pipeline {
  agent {
    node {
      label "master"
    }
  }

  environment {
    DATABASE_HOTSNAME = 'db'
    DATABASE_CONTAINER_NAME = 'mysql-database'
    WORDPRESS_HOSTNAME = 'wordpress'
    WORDPRESS_CONTAINER_NAME = 'wordpress-container'
    WORDPRESS_PORT = '8080'
  }

  stages {
    stage('Build') {
      steps {
        sh '''
            sudo yum update -y
            curl https://raw.githubusercontent.com/AvatarZorak/ITGix_Practice/main/template/wordpress-docker-compose.template -o docker-compose.template
            curl -s https://get.sdkman.io | bash
            source "~/.sdkman/bin/sdkman-init.sh"
            sdk install groovy
            export JAVA_HOME="/usr/bin/java"
            groovy docker-compose.groovy >> docker-compose.yaml
          '''
      }
    }
    stage('Deploy') {
      steps {
          sh '''
              ansible-playbook wordpress-starter.yaml
            '''
      }
    }
  }
}
